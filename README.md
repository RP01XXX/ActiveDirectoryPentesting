# Internal Pentesting Checklist
## Uncredentialed
### Pre-Assessment
- [ ] User Identification: LinkedIn Scrape, Dehashed, OSINT
- [ ] Wordlist Building: Scrape websites, popular sports teams in the area, industry related words from the area. (If a zoo, popular zoo names, if a school, team names)
### Network Enumeration
- [ ] NMAP Ping scan for living hosts: nmap -sP -iL <IP FILE> -oA NmapLiveHosts.txt
- [ ] NMAP live host scanning: nmap -A -p- -iL NmapLiveHosts.txt  >> NmapHostsSummary.txt
- [ ] NMAP PCI Testing: nmap -Pn -T5 -p 1-65535 -vv -iL IP.txt -oA output.txt
- [ ] Domain Discovery: Use CME to find the DC, Crackmapexec smb X.X.X.X/24 -u '' -p ''
- [ ] Find the DC: nslookup domain name
- [ ] Test for Null Domain Enumeration: enum4linux X.X.X.X -A
- [ ] Test for ldap bind: impacket-getadusers -all test.local/username:password -dc-ip X.X.X.X
- [ ] Screenshot any webpages in the network:eyewitness --web -f <nmap IP file> 
- [ ] DNS Footprinting: nslookup -type=<recordtype> <target domain>
- [ ] DNS Zone Transfer: dig axfr  <Domain_name> @name_server
- [ ] Obligatory SSL checks: sslscan X.X.X.X
### User Identification
The goal is to build a comprehensive userlist and validate them against the AD using kerbrute.
- [ ] User Identification: LinkedIn Scrape, Dehashed, OSINT
      **# Inspect Web Page > Console > Under People**
      
      const profileTitles = document.querySelectorAll('.org-people-profile-card__profile-title');
          let textList = '';
          for (let i = 0; i < profileTitles.length; i++) {
          if (profileTitles[i].innerText === "LinkedIn Member") {
             continue;
          }
          textList += profileTitles[i].innerText + '\n';
          }
          console.log(textList);
      **# Use this in terminal for the file**
        awk '{split($1, first, ""); last = $2; gsub(" ", "", last); print toupper(first[1]) tolower(last)}' your_file.txt
      
- [ ] SMB User Enumeration
    **  #Various methods**
        crackmapexec smb X.X.X.X/24 --users
        nmap -p88 --script krb5-enum-users --script args="krb5-enum-users.realm''DOMAIN' .userdb=USERLIST X.X.X.X
        enum4linunx -U X.X.X.X
        impacket-lookupsid Domain/guest@x.x.x.x
        smbclient -U domain/admin \\\\X.X.X.X\\IPC$ 

- [ ] Printers Enumeration Users
   ** #Find printers in the network and see if they have admin open or default creds**
      use the address book to add users to your list
- [ ] Default Credentials
      https://github.com/danielmiessler/SecLists/tree/master/Passwords/Default-Credentials
      https://github.com/ihebski/DefaultCreds-cheat-sheet/blob/main/DefaultCreds-Cheat-Sheet.csv
- [ ] Get AD User List
      GetADUsers.py DC.local/ -dc-ip 10.10.10.10 -debug
        CAPTURE USERS
        awk -F: '{print $1}' your_file.txt
        
        Capture Passwords
        awk -F: '{print $3}' your_file.txt
        
        GET RID of EMAIL
        awk -F'\\' '{print $2}'
- [ ] Kerbrute
   CAPTURE USERS
        kerbrute userenum -d DOMAIN.com --dc X.X.X.X username.txt -o validUsers
 
# Test for default usernames or typical names
Kerbrute typical username wordlists, I am building a service account username list from experiences
#### Pre-assessment work
- [ ] SMB Attempts: cme, nmap, enum4linux, impacket-getadusers
- [ ] Attempt to access printers to find usernames
- [ ] Default or typical users
- [ ] RPC Client
- [ ] Kerbrute users to validate legit usernames
### Password Attacks
- [ ] Using the kerbrute valid users, stuff passwords
- [ ] ASREP: see if any users had pre-authentication disabled
- [ ] CUPP can be used to build password possibilities
### Poisoning
- [ ] NMAP to find hosts with SMB signing not enforced
- [ ] Responder
- [ ] MITM6
- [ ] WPAD attack
- [ ] URL File attack (for null access SMB Shares)
### Protocol Attacks
General ports I typically see for quick wins but this is really elaborated upon in the worksheet
- [ ] SMB attacks: enumerate, vuln scan with NMAP
- [ ] LDAP: nmap
- [ ] SNMP UDP 161
- [ ] MySQL 1433
- [ ] SQL 3306
- [ ] HTTP/HTTPS
- [ ] SSH
- [ ] FTP
- [ ] WinRIM
- [ ] SMTP
- [ ] Telnet 21
- [ ] Erlang 4369
- [ ] Java RMI 1099
- [ ] Webdav
- [ ] VNC
- [ ] NFS 2049
- [ ] IPMI UDP 623

## Credentialed
In this section you have compromised a user account
### AD Enumeration
#### Quick Wins 
- [ ] Run Bloodhoun
- [ ] NoPAC
- [ ] GPP Password
- [ ] ASREP Roasting: Impacket, CME
- [ ] Kerberoasting: Bloodhound, impacket, CME
- [ ] Petitpotam
- [ ] ACL Abuse: this is easily identified from Bloodhound

### Get AD Information
- [ ] Password in AD User Description
- [ ] Get All AD Users with impacket-getadusers
- [ ] Pull groups, domain trusts, password policy with CME, review with bloodhound

### File Hunting
- [ ] Use manspider to hunt for sensitive files
- [ ] Snaffler is another good tool
- [ ] CME spider module

### URL File Attack
- [ ] Locate File Shares: You need write access
- [ ] Place a URL file attack and run responder to capture user hashes. Relay or crack them.


### AD Additional Attacks
- [ ] ADCS Attack
- [ ] Pingcastle
- [ ] Zerologon: DONT EXPLOIT THIS, just validate
- [ ] Printer Bug
- [ ] Unconstrained Delegation
- [ ] Resource Based Constrained Delegation
- [ ] Pass the Hash
- [ ] oken Imperonsation
- [ ] DC Sync
- [ ] Alternate Service Name
- [ ] S4U2 Self Abuse
- [ ] Shadow Credentials
- [ ] Silver Tickets
- [ ] Golden Tickets
- [ ] Diamond Tickets
- [ ] Forged Certificates

### Protocol Attacks
- [ ] SMB attacks: enumerate, vuln scan with NMAP
- [ ] LDAP: nmap
- [ ] SNMP UDP 161
- [ ] MySQL 1433: Attempt to login with windows auth then xp_command or relay attack
- [ ] SQL 3306
- [ ] HTTP/HTTPS
- [ ] SSH
- [ ] FTP
- [ ] WinRIM
- [ ] SMTP
- [ ] Telnet 21
- [ ] Erlang 4369
- [ ] Java RMI 1099
- [ ] Webdav
- [ ] VNC
- [ ] NFS 2049

### Elevated Access (Local admin)
- [ ] Hash Dumps with secretsdump, Donpapi, mimikatz
- [ ] Lateral movement: smbexec or wmiexec is often undetected, psexec works but move the file before launching

### Vulnerability Hunting
- [ ] Nanodump
- [ ] EternalBlue/Champion/Romance
- [ ] Printnightmare
- [ ] PrivExchange
- [ ] SMBBleed
- [ ] SMBGhost
- [ ] Apache Ghostcat
- [ ] JMI Insecure Endpoint
- [ ] NTP DDoS Amplification Attack
- [ ] Oracle Weblogic Deserialization
